From d3bafd696eff7250cee96e549be2afb2c548d8da Mon Sep 17 00:00:00 2001
From: Jo-Philipp Wich <jo@mein.io>
Date: Wed, 30 Mar 2016 03:19:23 +0200
Subject: [PATCH 89/93] x86: search PARTUUID in any block device

Signed-off-by: Jo-Philipp Wich <jo@mein.io>

Backport of LEDE 924fb794bde41eca8289c6cf10322bf6683b4a80
---
 target/linux/x86/base-files/lib/upgrade/platform.sh | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/target/linux/x86/base-files/lib/upgrade/platform.sh b/target/linux/x86/base-files/lib/upgrade/platform.sh
index f12deebf64..29eac77dfb 100644
--- a/target/linux/x86/base-files/lib/upgrade/platform.sh
+++ b/target/linux/x86/base-files/lib/upgrade/platform.sh
@@ -17,7 +17,8 @@ platform_export_bootpart() {
 			PARTUUID=[a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9][a-f0-9]-02)
 				uuid="${disk#PARTUUID=}"
 				uuid="${uuid%-02}"
-				for disk in /dev/[hsv]d[a-z] /dev/xvd[a-z]; do
+				for disk in /dev/*; do
+					[ -b "$disk" ] || continue
 					set -- $(dd if=$disk bs=1 skip=440 count=4 2>/dev/null | hexdump -v -e '4/1 "%02x "')
 					if [ "$4$3$2$1" = "$uuid" ]; then
 						export BOOTPART="${disk}1"
-- 
2.11.0

